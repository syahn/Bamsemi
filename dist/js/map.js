var app=app||{};app.MapView=function(){"use strict";var e=this;e.initMap=function(){e.markers=[],e.placeMarkers=[],e.map=new google.maps.Map(document.getElementById("map"),{center:{lat:37.566535,lng:126.977969},zoom:12,mapTypeControl:!1,streetViewControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},zoomControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER}}),e.infoWindow=new google.maps.InfoWindow,e.setMarkers(e.map,app.model.locations),e.addSearchBox(e.map),e.addYourLocationButton(e.map),e.showListings(),document.getElementById("go-places").addEventListener("click",e.textSearchPlaces),document.getElementById("show-listings").addEventListener("click",e.showListings),document.getElementById("hide-listings").addEventListener("click",function(){e.hideMarkers(e.markers)})},e.addSearchBox=function(o){var n=new google.maps.places.SearchBox(document.getElementById("places-search"));o.addListener("bounds_changed",function(){n.setBounds(this.getBounds())}),n.addListener("places_changed",function(){e.searchBoxPlaces(this)})},e.searchBoxPlaces=function(o){e.hideMarkers(e.placeMarkers);var n=o.getPlaces();0===n.length?window.alert("We did not find any places matching that search!"):e.createMarkersForPlaces(n)},e.textSearchPlaces=function(){var o=e.map.getBounds(),n=new google.maps.places.PlacesService(e.map);n.textSearch({query:document.getElementById("places-search").value,bounds:o},function(o,n){n===google.maps.places.PlacesServiceStatus.OK&&e.createMarkersForPlaces(o)})},e.createMarkersForPlaces=function(o){var n=new google.maps.LatLngBounds;o.forEach(function(o){if(!o.geometry)return void console.log("Returned place contains no geometry");var t={url:o.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)};e.placeMarkers.push(new google.maps.Marker({map:e.map,icon:t,title:o.name,position:o.geometry.location})),o.geometry.viewport?n.union(o.geometry.viewport):n.extend(o.geometry.location)}),e.map.fitBounds(n)},e.setMarkers=function(o,n){n.forEach(function(o){var n=o.class,t=app.model.logos[n];o.marker.setPosition(new google.maps.LatLng(o.lat,o.lng)),o.marker.setTitle(o.name),o.marker.setIcon(e.makeMarkerIcon(t)),o.marker.setAnimation(google.maps.Animation.DROP),o.marker.setVisible(!0),o.marker.setDraggable(!1),e.markers.push(o.marker),o.marker.addListener("mousedown",function(){e.populateInfoWindow(this,e.infoWindow,o)}),o.marker.addListener("mouseup",function(){this.setAnimation(google.maps.Animation.BOUNCE)}),o.marker.addListener("mouseout",function(){this.setAnimation(null)})})},e.makeMarkerIcon=function(e){var o=new google.maps.MarkerImage(e,new google.maps.Size(32,32),new google.maps.Point(0,0),new google.maps.Point(10,34),new google.maps.Size(32,32));return o},e.populateInfoWindow=function(o,n,t){console.log(t),n.marker!==o&&(n.marker=o,this.urlFoursquare="https://api.foursquare.com/v2/venues/explore",this.urlFoursquare+="?"+$.param({client_id:"T51K4CHANN5MBOX5DA2ANBWHRUS54LYEKTQY2KO3U4GSRFDP",client_secret:"SXWDCUMXYS2EDYVYHSTXWCVLOAGW0MWQTX4WBAO2F2KVNQ5C",ll:o.position.toUrlValue(),v:"20140806"}),$.ajax({url:this.urlFoursquare,dataType:"json"}).done(function(a){var i=a.response.groups[0].items[0],s=i.venue.name,r=i.tips[0].text,l=i.tips[0].canonicalUrl;n.setContent("<div><strong>"+t.name+"</strong></div><p>"+t.time+"</p><div><p>"+t.address+"</p>"+t.contact+'</div><div><hr><span>Nearby hot place by</span><img src="image/logo_foursquare.png" alt="Oops!"><br><span><strong>'+s+"</strong></span><p>"+r+'</p><a href="'+l+'">Link</a></div>'),n.open(e.map,o)}).fail(function(){alert("Somethings went wrong. Please, reload it.")}),n.addListener("closeclick",function(){n.marker=null}),document.getElementById("show-listings").addEventListener("click",function(){n.close()}))},e.showListings=function(){e.infoWindow.marker=null;var o=new google.maps.LatLngBounds;e.markers.forEach(function(n){n.setMap(e.map),o.extend(n.position)}),e.map.fitBounds(o)},e.hideMarkers=function(e){e.forEach(function(e){e.setMap(null)})},e.addYourLocationButton=function(o){var n=document.createElement("div"),t=document.createElement("button");t.style.backgroundColor="#fff",t.style.border="none",t.style.outline="none",t.style.width="28px",t.style.height="28px",t.style.borderRadius="2px",t.style.boxShadow="0 1px 4px rgba(0,0,0,0.3)",t.style.cursor="pointer",t.style.margin="15px 0 0 10px",t.style.padding="0px",t.title="Your Location",n.appendChild(t);var a=document.createElement("div");a.style.margin="5px",a.style.width="18px",a.style.height="18px",a.style.backgroundImage="url(https://maps.gstatic.com/tactile/mylocation/mylocation-sprite-1x.png)",a.style.backgroundSize="180px 18px",a.style.backgroundPosition="0px 0px",a.style.backgroundRepeat="no-repeat",a.id="you_location_img",t.appendChild(a),t.addEventListener("click",function(){var o="0",n=setInterval(function(){o="-18"==o?"0":"-18",document.getElementById("you_location_img").style["background-position"]=o+"px 0px"},500);navigator.geolocation?navigator.geolocation.getCurrentPosition(function(o){var t=new google.maps.LatLng(o.coords.latitude,o.coords.longitude);e.map.setCenter(t),e.map.setZoom(15),clearInterval(n),document.getElementById("you_location_img").style["background-position"]="-144px 0px"}):(clearInterval(n),document.getElementById("you_location_img").style["background-position"]="0px 0px")}),n.index=1,o.controls[google.maps.ControlPosition.TOP_LEFT].push(n)}};