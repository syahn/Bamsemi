var app=app||{};app.MapView=function(){"use strict";var e=this;e.initMap=function(){e.markers=[],e.placeMarkers=[],e.map=new google.maps.Map(document.getElementById("map"),{center:{lat:37.566535,lng:126.977969},zoom:12,mapTypeControl:!1,streetViewControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},zoomControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER}}),e.infoWindow=new google.maps.InfoWindow,e.setMarkers(e.map,app.model.locations),e.addSearchBox(e.map),e.addYourLocationButton(e.map),e.showListings(),document.getElementById("go-places").addEventListener("click",e.textSearchPlaces),document.getElementById("show-listings").addEventListener("click",e.showListings),document.getElementById("hide-listings").addEventListener("click",function(){e.hideMarkers(e.markers)})},e.addSearchBox=function(o){var t=new google.maps.places.SearchBox(document.getElementById("places-search"));t.setBounds(o.getBounds()),o.addListener("bounds_changed",function(){t.setBounds(this.getBounds())}),t.addListener("places_changed",function(){e.searchBoxPlaces(this)})},e.searchBoxPlaces=function(o){e.hideMarkers(placeMarkers);var t=o.getPlaces();0===t.length?window.alert("We did not find any places matching that search!"):e.createMarkersForPlaces(t)},e.textSearchPlaces=function(){var o=e.map.getBounds(),t=new google.maps.places.PlacesService(e.map);t.textSearch({query:document.getElementById("places-search").value,bounds:o},function(o,t){t===google.maps.places.PlacesServiceStatus.OK&&e.createMarkersForPlaces(o)})},e.createMarkersForPlaces=function(o){for(var t=new google.maps.LatLngBounds,n=0;n<o.length;n++){var a=o[n],s={url:a.icon,size:new google.maps.Size(35,35),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,34),scaledSize:new google.maps.Size(25,25)},i=new google.maps.Marker({map:map,icon:s,title:a.name,position:a.geometry.location,id:a.place_id});e.placeMarkers.push(i),a.geometry.viewport?t.union(a.geometry.viewport):t.extend(a.geometry.location)}e.map.fitBounds(t)},e.setMarkers=function(o,t){for(var n=0;n<t.length;n++){var a=new google.maps.LatLng(t[n].lat,t[n].lng),s=t[n].name,i=t[n].contact,r=t[n].time,l=t[n].address,c=t[n].class,p=app.model.logos[c],g=e.makeMarkerIcon(p),d=new google.maps.Marker({position:a,title:s,icon:g,animation:google.maps.Animation.DROP,contact:i,address:l,time:r,visible:!0});e.markers.push(d),d.addListener("mousedown",function(){e.populateInfoWindow(this,e.infoWindow)}),d.addListener("mouseover",function(){this.setAnimation(google.maps.Animation.BOUNCE)}),d.addListener("mouseout",function(){this.setAnimation(null)})}},e.makeMarkerIcon=function(e){var o=new google.maps.MarkerImage(e,new google.maps.Size(32,32),new google.maps.Point(0,0),new google.maps.Point(10,34),new google.maps.Size(32,32));return o},e.populateInfoWindow=function(o,t){if(t.marker!=o){t.marker=o;var n=$("#titleFourSquare"),a=$("#tipFourSquare");$("#urlFourSquare");this.urlFoursquare="https://api.foursquare.com/v2/venues/explore",this.urlFoursquare+="?"+$.param({client_id:"T51K4CHANN5MBOX5DA2ANBWHRUS54LYEKTQY2KO3U4GSRFDP",client_secret:"SXWDCUMXYS2EDYVYHSTXWCVLOAGW0MWQTX4WBAO2F2KVNQ5C",ll:o.position.toUrlValue(),v:"20140806"}),$.ajax({url:this.urlFoursquare,dataType:"json",success:function(s){var i=s.response.groups[0].items[0],r=i.venue.name,l=i.tips[0].text,c=i.tips[0].canonicalUrl;t.setContent("<div><strong>"+o.title+"</strong></div><p>"+o.time+"</p><div><p>"+o.address+"</p>"+o.contact+'</div><div><hr><span>Nearby hot place by</span><img src="image/logo_foursquare.png" alt="Oops!"><br><span><strong>'+r+"</strong></span><p>"+l+'</p><a href="'+c+'">Link</a></div>'),n.html(r),a.text=l,a.attr("href",c),t.open(e.map,o)}}).fail(function(){alert("Somethings went wrong. Please, reload it.")}),t.addListener("closeclick",function(){t.marker=null}),document.getElementById("show-listings").addEventListener("click",function(){t.close()})}},e.showListings=function(){e.infoWindow.marker=null;for(var o=new google.maps.LatLngBounds,t=0;t<e.markers.length;t++)e.markers[t].setMap(e.map),o.extend(e.markers[t].position);e.map.fitBounds(o)},e.hideMarkers=function(e){for(var o=0;o<e.length;o++)e[o].setMap(null)},e.addYourLocationButton=function(o){var t=document.createElement("div"),n=document.createElement("button");n.style.backgroundColor="#fff",n.style.border="none",n.style.outline="none",n.style.width="28px",n.style.height="28px",n.style.borderRadius="2px",n.style.boxShadow="0 1px 4px rgba(0,0,0,0.3)",n.style.cursor="pointer",n.style.margin="15px 0 0 10px",n.style.padding="0px",n.title="Your Location",t.appendChild(n);var a=document.createElement("div");a.style.margin="5px",a.style.width="18px",a.style.height="18px",a.style.backgroundImage="url(https://maps.gstatic.com/tactile/mylocation/mylocation-sprite-1x.png)",a.style.backgroundSize="180px 18px",a.style.backgroundPosition="0px 0px",a.style.backgroundRepeat="no-repeat",a.id="you_location_img",n.appendChild(a),google.maps.event.addListener(e.map,"dragend",function(){$("#you_location_img").css("background-position","0px 0px")}),n.addEventListener("click",function(){var o="0",t=setInterval(function(){o="-18"==o?"0":"-18",$("#you_location_img").css("background-position",o+"px 0px")},500);navigator.geolocation?navigator.geolocation.getCurrentPosition(function(o){var n=new google.maps.LatLng(o.coords.latitude,o.coords.longitude);e.map.setCenter(n),e.map.setZoom(15),clearInterval(t),$("#you_location_img").css("background-position","-144px 0px")}):(clearInterval(t),$("#you_location_img").css("background-position","0px 0px"))}),t.index=1,o.controls[google.maps.ControlPosition.TOP_LEFT].push(t)}};